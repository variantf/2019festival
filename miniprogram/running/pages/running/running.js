"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var app = getApp();
var host1_1 = require("./host1");
var host2_1 = require("./host2");
var host3_1 = require("./host3");
var host4_1 = require("./host4");
var host5_1 = require("./host5");
var host6_1 = require("./host6");
var host7_1 = require("./host7");
var host8_1 = require("./host8");
var HOSTS = [
    host1_1.HOST_1, host2_1.HOST_2, host3_1.HOST_3, host4_1.HOST_4,
    host5_1.HOST_5, host6_1.HOST_6, host7_1.HOST_7, host8_1.HOST_8
];
Page({
    onShow: function () {
        app.sound("start");
    },
    data: {
        sid: '',
        pid: '',
        questionNumber: 0,
        questionContent: "",
        choiceA: "",
        choiceB: "",
        lastChoice: '',
        lastChoiceStatus: 'unknown',
        LOTTERY_CORRECT_COUNT: 3,
        HOST_SRC: ''
    },
    nextQuestionPending: false,
    nextQuestion: function (evt) {
        if (this.nextQuestionPending) {
            return;
        }
        var choice = evt.currentTarget.id;
        var page = this;
        this.nextQuestionPending = true;
        this.setData({ lastChoice: choice });
        wx.request({
            method: "POST",
            url: app.API_ENDPOINT + ("/session/" + this.data.sid + "/problem/" + this.data.pid),
            data: {
                ans: choice
            },
            header: {
                'X-User-Token': app.globalData.token
            },
            success: app.handleRequstFinish(function (res) {
                var session = res.data;
                if (session.status == 'done') {
                    app.sound("failed");
                    page.setData({ lastChoiceStatus: 'error' });
                    setTimeout(function () {
                        page.nextQuestionPending = false;
                        if (session.correct_count >= page.data.LOTTERY_CORRECT_COUNT) {
                            wx.redirectTo({
                                url: "../success/success?correct_count=" + session.correct_count + "&session_id=" + session.id,
                            });
                        }
                        else {
                            wx.redirectTo({
                                url: '../failure/failure'
                            });
                        }
                    }, 500);
                }
                else {
                    app.sound("correct");
                    page.setData({ lastChoiceStatus: 'correct' });
                    setTimeout(function () {
                        page.nextQuestionPending = false;
                        page.setData({
                            pid: session.problem.id,
                            questionContent: session.problem.body,
                            questionNumber: session.problem.idx,
                            choiceA: session.problem.A,
                            choiceB: session.problem.B,
                            lastChoiceStatus: 'unknown'
                        });
                    }, 500);
                }
            }),
            fail: function (res) {
                page.nextQuestionPending = false;
                app.handleRequestFail(res);
            }
        });
    },
    onLoad: function () {
        this.setData({
            HOST_SRC: "data:image/png;base64," + HOSTS[Math.floor(Math.random() * 8)]
        });
        var self = this;
        wx.request({
            url: app.API_ENDPOINT + "/session",
            method: "POST",
            header: {
                'X-User-Token': app.globalData.token
            },
            success: app.handleRequstFinish(function (res) {
                var session = res.data;
                self.setData({
                    sid: session.id,
                    pid: session.problem.id,
                    questionContent: session.problem.body,
                    questionNumber: session.problem.idx,
                    choiceA: session.problem.A,
                    choiceB: session.problem.B
                });
            }),
            fail: app.handleRequestFail
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnVubmluZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInJ1bm5pbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJLEdBQUcsR0FBRyxNQUFNLEVBQWMsQ0FBQztBQUUvQixpQ0FBaUM7QUFDakMsaUNBQWlDO0FBQ2pDLGlDQUFpQztBQUNqQyxpQ0FBaUM7QUFDakMsaUNBQWlDO0FBQ2pDLGlDQUFpQztBQUNqQyxpQ0FBaUM7QUFDakMsaUNBQWlDO0FBRWpDLElBQU0sS0FBSyxHQUFrQjtJQUMzQixjQUFNLEVBQUUsY0FBTSxFQUFFLGNBQU0sRUFBRSxjQUFNO0lBQzlCLGNBQU0sRUFBRSxjQUFNLEVBQUUsY0FBTSxFQUFFLGNBQU07Q0FDL0IsQ0FBQTtBQUVELElBQUksQ0FBQztJQUNILE1BQU07UUFDSixHQUFHLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3JCLENBQUM7SUFDRCxJQUFJLEVBQUU7UUFDSixHQUFHLEVBQUUsRUFBRTtRQUNQLEdBQUcsRUFBRSxFQUFFO1FBQ1AsY0FBYyxFQUFDLENBQUM7UUFDaEIsZUFBZSxFQUFDLEVBQUU7UUFDbEIsT0FBTyxFQUFDLEVBQUU7UUFDVixPQUFPLEVBQUMsRUFBRTtRQUNWLFVBQVUsRUFBRSxFQUFFO1FBQ2QsZ0JBQWdCLEVBQUUsU0FBUztRQUMzQixxQkFBcUIsRUFBRSxDQUFDO1FBQ3hCLFFBQVEsRUFBRSxFQUFFO0tBQ2I7SUFDRCxtQkFBbUIsRUFBRSxLQUFLO0lBQzFCLFlBQVksRUFBRSxVQUFVLEdBQVE7UUFDOUIsSUFBSSxJQUFJLENBQUMsbUJBQW1CLEVBQUU7WUFDMUIsT0FBTztTQUNWO1FBQ0QsSUFBSSxNQUFNLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUM7UUFDbEMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUM7UUFDaEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxF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RTtnQkFDTixjQUFjLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLO2FBQ3JDO1lBQ0QsT0FBTyxFQUFFLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxVQUFDLEdBQVE7Z0JBQ3ZDLElBQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQ3pCLElBQUksQ0FBQyxPQUFPLENBQUM7b0JBQ1gsR0FBRyxFQUFFLE9BQU8sQ0FBQyxFQUFFO29CQUNmLEdBQUcsRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7b0JBQ3ZCLGVBQWUsRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUk7b0JBQ3JDLGNBQWMsRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUc7b0JBQ25DLE9BQU8sRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQzFCLE9BQU8sRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7aUJBQzNCLENBQUMsQ0FBQTtZQUNKLENBQUMsQ0FBQztZQUNGLElBQUksRUFBRSxHQUFHLENBQUMsaUJBQWlCO1NBQzVCLENBQUMsQ0FBQTtJQUNKLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gZ2V0QXBwPElBcHBPcHRpb24+KCk7XG5cbmltcG9ydCB7IEhPU1RfMSB9IGZyb20gXCIuL2hvc3QxXCI7XG5pbXBvcnQgeyBIT1NUXzIgfSBmcm9tIFwiLi9ob3N0MlwiO1xuaW1wb3J0IHsgSE9TVF8zIH0gZnJvbSBcIi4vaG9zdDNcIjtcbmltcG9ydCB7IEhPU1RfNCB9IGZyb20gXCIuL2hvc3Q0XCI7XG5pbXBvcnQgeyBIT1NUXzUgfSBmcm9tIFwiLi9ob3N0NVwiO1xuaW1wb3J0IHsgSE9TVF82IH0gZnJvbSBcIi4vaG9zdDZcIjtcbmltcG9ydCB7IEhPU1RfNyB9IGZyb20gXCIuL2hvc3Q3XCI7XG5pbXBvcnQgeyBIT1NUXzggfSBmcm9tIFwiLi9ob3N0OFwiO1xuXG5jb25zdCBIT1NUUzogQXJyYXk8c3RyaW5nPiA9IFtcbiAgSE9TVF8xLCBIT1NUXzIsIEhPU1RfMywgSE9TVF80LFxuICBIT1NUXzUsIEhPU1RfNiwgSE9TVF83LCBIT1NUXzhcbl1cblxuUGFnZSh7XG4gIG9uU2hvdygpIHtcbiAgICBhcHAuc291bmQoXCJzdGFydFwiKTtcbiAgfSxcbiAgZGF0YToge1xuICAgIHNpZDogJycsXG4gICAgcGlkOiAnJyxcbiAgICBxdWVzdGlvbk51bWJlcjowLFxuICAgIHF1ZXN0aW9uQ29udGVudDpcIlwiLFxuICAgIGNob2ljZUE6XCJcIixcbiAgICBjaG9pY2VCOlwiXCIsXG4gICAgbGFzdENob2ljZTogJycsXG4gICAgbGFzdENob2ljZVN0YXR1czogJ3Vua25vd24nLFxuICAgIExPVFRFUllfQ09SUkVDVF9DT1VOVDogMyxcbiAgICBIT1NUX1NSQzogJydcbiAgfSxcbiAgbmV4dFF1ZXN0aW9uUGVuZGluZzogZmFsc2UsXG4gIG5leHRRdWVzdGlvbjogZnVuY3Rpb24gKGV2dDogYW55KSB7XG4gICAgaWYgKHRoaXMubmV4dFF1ZXN0aW9uUGVuZGluZykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBjaG9pY2UgPSBldnQuY3VycmVudFRhcmdldC5pZDtcbiAgICB2YXIgcGFnZSA9IHRoaXM7XG4gICAgdGhpcy5uZXh0UXVlc3Rpb25QZW5kaW5nID0gdHJ1ZTtcbiAgICB0aGlzLnNldERhdGEoeyBsYXN0Q2hvaWNlOiBjaG9pY2UgfSk7XG4gICAgd3gucmVxdWVzdCh7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIHVybDogYXBwLkFQSV9FTkRQT0lOVCArIChcIi9zZXNzaW9uL1wiICsgdGhpcy5kYXRhLnNpZCArIFwiL3Byb2JsZW0vXCIgKyB0aGlzLmRhdGEucGlkKSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgYW5zOiBjaG9pY2VcbiAgICAgICAgfSxcbiAgICAgICAgaGVhZGVyOiB7XG4gICAgICAgICAgICAnWC1Vc2VyLVRva2VuJzogYXBwLmdsb2JhbERhdGEudG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAgc3VjY2VzczogYXBwLmhhbmRsZVJlcXVzdEZpbmlzaChmdW5jdGlvbiAocmVzOiBhbnkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSByZXMuZGF0YTtcbiAgICAgICAgICAgIGlmIChzZXNzaW9uLnN0YXR1cyA9PSAnZG9uZScpIHtcbiAgICAgICAgICAgICAgYXBwLnNvdW5kKFwiZmFpbGVkXCIpXG4gICAgICAgICAgICAgICAgcGFnZS5zZXREYXRhKHsgbGFzdENob2ljZVN0YXR1czogJ2Vycm9yJyB9KTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZS5uZXh0UXVlc3Rpb25QZW5kaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uLmNvcnJlY3RfY291bnQgPj0gcGFnZS5kYXRhLkxPVFRFUllfQ09SUkVDVF9DT1VOVCkge1xuICAgICAgICAgICAgICAgICAgICAgIHd4LnJlZGlyZWN0VG8oe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBgLi4vc3VjY2Vzcy9zdWNjZXNzP2NvcnJlY3RfY291bnQ9JHtzZXNzaW9uLmNvcnJlY3RfY291bnR9JnNlc3Npb25faWQ9JHtzZXNzaW9uLmlkfWAsXG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgd3gucmVkaXJlY3RUbyh7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICcuLi9mYWlsdXJlL2ZhaWx1cmUnXG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCA1MDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIGFwcC5zb3VuZChcImNvcnJlY3RcIilcbiAgICAgICAgICAgICAgICBwYWdlLnNldERhdGEoeyBsYXN0Q2hvaWNlU3RhdHVzOiAnY29ycmVjdCcgfSk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2UubmV4dFF1ZXN0aW9uUGVuZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBwYWdlLnNldERhdGEoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcGlkOiBzZXNzaW9uLnByb2JsZW0uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbkNvbnRlbnQ6IHNlc3Npb24ucHJvYmxlbS5ib2R5LFxuICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25OdW1iZXI6IHNlc3Npb24ucHJvYmxlbS5pZHgsXG4gICAgICAgICAgICAgICAgICAgICAgICBjaG9pY2VBOiBzZXNzaW9uLnByb2JsZW0uQSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNob2ljZUI6IHNlc3Npb24ucHJvYmxlbS5CLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdENob2ljZVN0YXR1czogJ3Vua25vd24nXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLFxuICAgICAgICBmYWlsOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICBwYWdlLm5leHRRdWVzdGlvblBlbmRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIGFwcC5oYW5kbGVSZXF1ZXN0RmFpbChyZXMpO1xuICAgICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgb25Mb2FkKCkge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBIT1NUX1NSQzogXCJkYXRhOmltYWdlL3BuZztiYXNlNjQsXCIrIEhPU1RTW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDgpXVxuICAgIH0pO1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIHd4LnJlcXVlc3Qoe1xuICAgICAgdXJsOiBhcHAuQVBJX0VORFBPSU5UICsgXCIvc2Vzc2lvblwiLFxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcjoge1xuICAgICAgICAnWC1Vc2VyLVRva2VuJzogYXBwLmdsb2JhbERhdGEudG9rZW5cbiAgICAgIH0sXG4gICAgICBzdWNjZXNzOiBhcHAuaGFuZGxlUmVxdXN0RmluaXNoKChyZXM6IGFueSkgPT4ge1xuICAgICAgICBjb25zdCBzZXNzaW9uID0gcmVzLmRhdGE7XG4gICAgICAgIHNlbGYuc2V0RGF0YSh7XG4gICAgICAgICAgc2lkOiBzZXNzaW9uLmlkLFxuICAgICAgICAgIHBpZDogc2Vzc2lvbi5wcm9ibGVtLmlkLFxuICAgICAgICAgIHF1ZXN0aW9uQ29udGVudDogc2Vzc2lvbi5wcm9ibGVtLmJvZHksXG4gICAgICAgICAgcXVlc3Rpb25OdW1iZXI6IHNlc3Npb24ucHJvYmxlbS5pZHgsXG4gICAgICAgICAgY2hvaWNlQTogc2Vzc2lvbi5wcm9ibGVtLkEsXG4gICAgICAgICAgY2hvaWNlQjogc2Vzc2lvbi5wcm9ibGVtLkJcbiAgICAgICAgfSlcbiAgICAgIH0pLFxuICAgICAgZmFpbDogYXBwLmhhbmRsZVJlcXVlc3RGYWlsXG4gICAgfSlcbiAgfVxufSlcbiJdfQ==