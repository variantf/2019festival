"use strict";
var app = getApp();
Page({
    data: {
        sid: '',
        pid: '',
        questionNumber: 0,
        questionContent: "",
        choiceA: "",
        choiceB: "",
        lastChoice: '',
        lastChoiceStatus: 'unknown',
        LOTTERY_CORRECT_COUNT: 3
    },
    nextQuestionPending: false,
    nextQuestion: function (evt) {
        if (this.nextQuestionPending) {
            return;
        }
        var choice = evt.currentTarget.id;
        var page = this;
        this.nextQuestionPending = true;
        this.setData({ lastChoice: choice });
        wx.request({
            method: "POST",
            url: app.API_ENDPOINT + ("/session/" + this.data.sid + "/problem/" + this.data.pid),
            data: {
                ans: choice
            },
            header: {
                'X-User-Token': app.globalData.token
            },
            success: app.handleRequstFinish(function (res) {
                var session = res.data;
                if (session.status == 'done') {
                    page.setData({ lastChoiceStatus: 'error' });
                    setTimeout(function () {
                        page.nextQuestionPending = false;
                        if (session.correct_count >= page.data.LOTTERY_CORRECT_COUNT) {
                            wx.redirectTo({
                                url: "../success/success?correct_count=" + session.correct_count,
                            });
                        }
                        else {
                            wx.redirectTo({
                                url: '../failure/failure'
                            });
                        }
                    }, 500);
                }
                else {
                    page.setData({ lastChoiceStatus: 'correct' });
                    setTimeout(function () {
                        page.nextQuestionPending = false;
                        page.setData({
                            pid: session.problem.id,
                            questionContent: session.problem.body,
                            questionNumber: session.problem.idx,
                            choiceA: session.problem.A,
                            choiceB: session.problem.B,
                            lastChoiceStatus: 'unknown'
                        });
                    }, 500);
                }
            }),
            fail: function (res) {
                page.nextQuestionPending = false;
                app.handleRequestFail(res);
            }
        });
    },
    onLoad: function () {
        var self = this;
        wx.request({
            url: app.API_ENDPOINT + "/session",
            method: "POST",
            header: {
                'X-User-Token': app.globalData.token
            },
            success: app.handleRequstFinish(function (res) {
                var session = res.data;
                self.setData({
                    sid: session.id,
                    pid: session.problem.id,
                    questionContent: session.problem.body,
                    questionNumber: session.problem.idx,
                    choiceA: session.problem.A,
                    choiceB: session.problem.B
                });
            }),
            fail: app.handleRequestFail
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnVubmluZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInJ1bm5pbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQUksR0FBRyxHQUFHLE1BQU0sRUFBYyxDQUFBO0FBRTlCLElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLEdBQUcsRUFBRSxFQUFFO1FBQ1AsR0FBRyxFQUFFLEVBQUU7UUFDUCxjQUFjLEVBQUMsQ0FBQztRQUNoQixlQUFlLEVBQUMsRUFBRTtRQUNsQixPQUFPLEVBQUMsRUFBRTtRQUNWLE9BQU8sRUFBQyxFQUFFO1FBQ1YsVUFBVSxFQUFFLEVBQUU7UUFDZCxnQkFBZ0IsRUFBRSxTQUFTO1FBQzNCLHFCQUFxQixFQUFFLENBQUM7S0FDekI7SUFDRCxtQkFBbUIsRUFBRSxLQUFLO0lBQzFCLFlBQVksRUFBRSxVQUFVLEdBQVE7UUFDOUIsSUFBSSxJQUFJLENBQUMsbUJBQW1CLEVBQUU7WUFDMUIsT0FBTztTQUNWO1FBQ0QsSUFBSSxNQUFNLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUM7UUFDbEMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUM7UUFDaEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ3JDLEVBQUUsQ0FBQyxPQUFPLENBQUM7WUFDUCxNQUFNLEVBQUUsTUFBTTtZQUNkLEdBQUcsRUFBRSxHQUFHLENBQUMsWUFBWSxHQUFHLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztZQUNuRixJQUFJLEVBQUU7Z0JBQ0YsR0FBRyxFQUFFLE1BQU07YUFDZDtZQUNELE1BQU0sRUFBRTtnQkFDSixjQUFjLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLO2FBQ3ZDO1lBQ0QsT0FBTyxFQUFFLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxVQUFVLEdBQVE7Z0JBQzlDLElBQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQ3pCLElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxNQUFNLEVBQUU7b0JBQzFCLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxnQkFBZ0IsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDO29CQUM1QyxVQUFVLENBQUM7d0JBQ1AsSUFBSSxDQUFDLG1CQUFtQixHQUFHLEtBQUssQ0FBQzt3QkFDakMsSUFBSSxPQUFPLENBQUMsYUFBYSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUU7NEJBQzVELEVBQUUsQ0FBQyxVQUFVLENBQUM7Z0NBQ1osR0FBRyxFQUFFLHNDQUFvQyxPQUFPLENBQUMsYUFBZTs2QkFDakUsQ0FBQyxDQUFDO3lCQUNKOzZCQUFNOzRCQUNMLEVBQUUsQ0FBQyxVQUFVLENBQUM7Z0NBQ1osR0FBRyxFQUFFLG9CQUFvQjs2QkFDMUIsQ0FBQyxDQUFDO3lCQUNKO29CQUNMLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztpQkFDWDtxQkFDSTtvQkFDRCxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsZ0JBQWdCLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQztvQkFDOUMsVUFBVSxDQUFDO3dCQUNQLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxLQUFLLENBQUM7d0JBQ2pDLElBQUksQ0FBQyxPQUFPLENBQUM7NEJBQ1QsR0FBRyxFQUFFLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTs0QkFDdkIsZUFBZSxFQUFFLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSTs0QkFDckMsY0FBYyxFQUFFLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRzs0QkFDbkMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQzs0QkFDMUIsT0FBTyxFQUFFLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQzs0QkFDMUIsZ0JBQWdCLEVBQUUsU0FBUzt5QkFDOUIsQ0FBQyxDQUFDO29CQUNQLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztpQkFDWDtZQUNMLENBQUMsQ0FBQztZQUNGLElBQUksRUFBRSxVQUFVLEdBQUc7Z0JBQ2YsSUFBSSxDQUFDLG1CQUFtQixHQUFHLEtBQUssQ0FBQztnQkFDakMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQy9CLENBQUM7U0FDSixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsTUFBTTtRQUNKLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQztRQUNsQixFQUFFLENBQUMsT0FBTyxDQUFDO1lBQ1QsR0FBRyxFQUFFLEdBQUcsQ0FBQyxZQUFZLEdBQUcsVUFBVTtZQUNsQyxNQUFNLEVBQUUsTUFBTTtZQUNkLE1BQU0sRUFBRTtnQkFDTixjQUFjLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLO2FBQ3JDO1lBQ0QsT0FBTyxFQUFFLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxVQUFDLEdBQVE7Z0JBQ3ZDLElBQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQ3pCLElBQUksQ0FBQyxPQUFPLENBQUM7b0JBQ1gsR0FBRyxFQUFFLE9BQU8sQ0FBQyxFQUFFO29CQUNmLEdBQUcsRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7b0JBQ3ZCLGVBQWUsRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUk7b0JBQ3JDLGNBQWMsRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUc7b0JBQ25DLE9BQU8sRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQzFCLE9BQU8sRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7aUJBQzNCLENBQUMsQ0FBQTtZQUNKLENBQUMsQ0FBQztZQUNGLElBQUksRUFBRSxHQUFHLENBQUMsaUJBQWlCO1NBQzVCLENBQUMsQ0FBQTtJQUNKLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gZ2V0QXBwPElBcHBPcHRpb24+KClcblxuUGFnZSh7XG4gIGRhdGE6IHtcbiAgICBzaWQ6ICcnLFxuICAgIHBpZDogJycsXG4gICAgcXVlc3Rpb25OdW1iZXI6MCxcbiAgICBxdWVzdGlvbkNvbnRlbnQ6XCJcIixcbiAgICBjaG9pY2VBOlwiXCIsXG4gICAgY2hvaWNlQjpcIlwiLFxuICAgIGxhc3RDaG9pY2U6ICcnLFxuICAgIGxhc3RDaG9pY2VTdGF0dXM6ICd1bmtub3duJyxcbiAgICBMT1RURVJZX0NPUlJFQ1RfQ09VTlQ6IDNcbiAgfSxcbiAgbmV4dFF1ZXN0aW9uUGVuZGluZzogZmFsc2UsXG4gIG5leHRRdWVzdGlvbjogZnVuY3Rpb24gKGV2dDogYW55KSB7XG4gICAgaWYgKHRoaXMubmV4dFF1ZXN0aW9uUGVuZGluZykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBjaG9pY2UgPSBldnQuY3VycmVudFRhcmdldC5pZDtcbiAgICB2YXIgcGFnZSA9IHRoaXM7XG4gICAgdGhpcy5uZXh0UXVlc3Rpb25QZW5kaW5nID0gdHJ1ZTtcbiAgICB0aGlzLnNldERhdGEoeyBsYXN0Q2hvaWNlOiBjaG9pY2UgfSk7XG4gICAgd3gucmVxdWVzdCh7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIHVybDogYXBwLkFQSV9FTkRQT0lOVCArIChcIi9zZXNzaW9uL1wiICsgdGhpcy5kYXRhLnNpZCArIFwiL3Byb2JsZW0vXCIgKyB0aGlzLmRhdGEucGlkKSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgYW5zOiBjaG9pY2VcbiAgICAgICAgfSxcbiAgICAgICAgaGVhZGVyOiB7XG4gICAgICAgICAgICAnWC1Vc2VyLVRva2VuJzogYXBwLmdsb2JhbERhdGEudG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAgc3VjY2VzczogYXBwLmhhbmRsZVJlcXVzdEZpbmlzaChmdW5jdGlvbiAocmVzOiBhbnkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSByZXMuZGF0YTtcbiAgICAgICAgICAgIGlmIChzZXNzaW9uLnN0YXR1cyA9PSAnZG9uZScpIHtcbiAgICAgICAgICAgICAgICBwYWdlLnNldERhdGEoeyBsYXN0Q2hvaWNlU3RhdHVzOiAnZXJyb3InIH0pO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBwYWdlLm5leHRRdWVzdGlvblBlbmRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlc3Npb24uY29ycmVjdF9jb3VudCA+PSBwYWdlLmRhdGEuTE9UVEVSWV9DT1JSRUNUX0NPVU5UKSB7XG4gICAgICAgICAgICAgICAgICAgICAgd3gucmVkaXJlY3RUbyh7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGAuLi9zdWNjZXNzL3N1Y2Nlc3M/Y29ycmVjdF9jb3VudD0ke3Nlc3Npb24uY29ycmVjdF9jb3VudH1gLFxuICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgIHd4LnJlZGlyZWN0VG8oe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAnLi4vZmFpbHVyZS9mYWlsdXJlJ1xuICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgNTAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHBhZ2Uuc2V0RGF0YSh7IGxhc3RDaG9pY2VTdGF0dXM6ICdjb3JyZWN0JyB9KTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZS5uZXh0UXVlc3Rpb25QZW5kaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2Uuc2V0RGF0YSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBwaWQ6IHNlc3Npb24ucHJvYmxlbS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uQ29udGVudDogc2Vzc2lvbi5wcm9ibGVtLmJvZHksXG4gICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbk51bWJlcjogc2Vzc2lvbi5wcm9ibGVtLmlkeCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNob2ljZUE6IHNlc3Npb24ucHJvYmxlbS5BLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2hvaWNlQjogc2Vzc2lvbi5wcm9ibGVtLkIsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0Q2hvaWNlU3RhdHVzOiAndW5rbm93bidcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgNTAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSksXG4gICAgICAgIGZhaWw6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHBhZ2UubmV4dFF1ZXN0aW9uUGVuZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgYXBwLmhhbmRsZVJlcXVlc3RGYWlsKHJlcyk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBvbkxvYWQoKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgd3gucmVxdWVzdCh7XG4gICAgICB1cmw6IGFwcC5BUElfRU5EUE9JTlQgKyBcIi9zZXNzaW9uXCIsXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyOiB7XG4gICAgICAgICdYLVVzZXItVG9rZW4nOiBhcHAuZ2xvYmFsRGF0YS50b2tlblxuICAgICAgfSxcbiAgICAgIHN1Y2Nlc3M6IGFwcC5oYW5kbGVSZXF1c3RGaW5pc2goKHJlczogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSByZXMuZGF0YTtcbiAgICAgICAgc2VsZi5zZXREYXRhKHtcbiAgICAgICAgICBzaWQ6IHNlc3Npb24uaWQsXG4gICAgICAgICAgcGlkOiBzZXNzaW9uLnByb2JsZW0uaWQsXG4gICAgICAgICAgcXVlc3Rpb25Db250ZW50OiBzZXNzaW9uLnByb2JsZW0uYm9keSxcbiAgICAgICAgICBxdWVzdGlvbk51bWJlcjogc2Vzc2lvbi5wcm9ibGVtLmlkeCxcbiAgICAgICAgICBjaG9pY2VBOiBzZXNzaW9uLnByb2JsZW0uQSxcbiAgICAgICAgICBjaG9pY2VCOiBzZXNzaW9uLnByb2JsZW0uQlxuICAgICAgICB9KVxuICAgICAgfSksXG4gICAgICBmYWlsOiBhcHAuaGFuZGxlUmVxdWVzdEZhaWxcbiAgICB9KVxuICB9XG59KVxuIl19